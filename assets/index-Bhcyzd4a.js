(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const u of e.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function r(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(t){if(t.ep)return;t.ep=!0;const e=r(t);fetch(t.href,e)}})();function L(o){o.addSource("eraser",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[139.66434016560476,35.70734762727297],[139.66506846307053,35.707289104885675],[139.66513700246438,35.70688371493084],[139.66435569957977,35.70687233504728]]],type:"Polygon"}}]}}),o.addLayer({id:"eraser",type:"clip",source:"eraser",layout:{"clip-layer-types":["symbol","model"]}})}function w(o){let a=[139.6902,35.689],r={day:"day",night:"night",zero:"zero"},s=r.zero,t=!1,e,u,n,c=null;o.addLayer({id:"flight-route-layer",type:"custom",renderingMode:"3d",onAdd:function(i,y){window.tb=new Threebox(i,y,{realSunlight:!0}),v()},render:function(i,y){tb.update()}});async function v(){e=tb.lightDateTime;let i=e.getHours()*3600+e.getMinutes()*60+e.getSeconds();n=document.getElementById("time"),n.value=i,u=i,m(e,a),n.oninput=()=>{i=+n.value,e.setHours(Math.floor(i/3600)),e.setMinutes(Math.floor(i/60)%60),e.setSeconds(i%60),o.triggerRepaint()};function y(d=new Date,f){let g=d.toLocaleString("en-US",{timeZone:f});return new Date(g)}o.on("render",()=>{tb.setSunlight(e),y(e,"Asia/Tokyo"),hour.innerHTML="Sunlight on date/time: "+e.toLocaleString(),m(e,a),o.sunPosition=tb.sunPosition});function m(d,f){const g=tb.getSunPosition(d,[-.12501974,51.53]);function P(p){return p*180/Math.PI}const x=P(g.azimuth);function S(p){return(p%360+360)%360}let h=tb.getSunTimes(d,f);d>=h.sunriseEnd&&d<=h.sunsetStart?(s!=r.day||s==r.zero)&&(console.log("it's day"),o.setPaintProperty("background","background-color","#7fb4f7"),o.setPaintProperty("building-extrusion","fill-extrusion-color","#ffffff"),o.setPaintProperty("custom-extrusion-layer","fill-extrusion-color","#ffffff"),s=r.day,t=!0):s!=r.night&&(console.log("it's night"),o.setPaintProperty("background","background-color","#808080"),o.setPaintProperty("building-extrusion","fill-extrusion-color","#808080"),o.setPaintProperty("custom-extrusion-layer","fill-extrusion-color","#808080"),s=r.night,t=!1),o.setLights([{id:"directional",type:"directional",properties:{color:"rgba(255.0, 255.0, 255.0, 1.0)",intensity:1,direction:[S(x),45],"cast-shadows":t,"shadow-intensity":1}}])}}document.getElementById("playButton").addEventListener("click",()=>{c=setInterval(()=>{var i=parseInt(n.value)+50;n.value=i,n.dispatchEvent(new Event("input"))},100)}),document.getElementById("pauseButton").addEventListener("click",()=>{c!=null&&(clearInterval(c),c=null);const i=o.getStyle().layers;console.log(i)}),document.getElementById("resetButton").addEventListener("click",()=>{n.value=u,n.dispatchEvent(new Event("input"))})}const T="pk.eyJ1IjoidmZhc29ucGQiLCJhIjoiY2tvbTl3NHFvMHU1YjJ3bzd4cnp0c2h2NSJ9.MXSJRTka-63tR-t8RK-Xag";mapboxgl.accessToken=T;var b=[139.66461146239243,35.70698328883841];const l=new mapboxgl.Map({container:"map",center:b,zoom:15.27,pitch:42,bearing:-50,style:"mapbox://styles/vfasonpd/ckomjiv0e0bka17mzt5z7v5ij",minZoom:15,maxZoom:18});l.on("style.load",()=>{L(l),l.setConfigProperty("basemap","lightPreset","dusk"),l.addSource("model",{type:"geojson",data:{type:"Feature",properties:{"model-uri":"https://sonpd-vitalify-asia.github.io/BIMLoader/tower.glb"},geometry:{coordinates:b,type:"Point"}}}),l.addLayer({id:"tower",type:"model",slot:"middle",source:"model",minzoom:15,layout:{"model-id":["get","model-uri"]},paint:{"model-opacity":1,"model-rotation":[0,0,0],"model-scale":[1,1,1.5],"model-color-mix-intensity":0,"model-cast-shadows":!0,"model-emissive-strength":.8}});const o={type:"FeatureCollection",features:[{type:"Feature",properties:{height:15},geometry:{type:"Polygon",coordinates:[[[139.66444844801015,35.70729972742914],[139.66497690707288,35.70729609087284],[139.66493212240653,35.70808158318436],[139.66439918487717,35.70809249274527]]]}}]};l.addSource("custom-extrusion",{type:"geojson",data:o}),l.addLayer({id:"custom-extrusion-layer",type:"fill-extrusion",source:"custom-extrusion",paint:{"fill-extrusion-color":"#ffffff","fill-extrusion-height":["get","height"],"fill-extrusion-base":0,"fill-extrusion-opacity":1}}),w(l)});
