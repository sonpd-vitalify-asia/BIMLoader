(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const f of e.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&u(f)}).observe(document,{childList:!0,subtree:!0});function a(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerPolicy&&(e.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?e.credentials="include":o.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function u(o){if(o.ep)return;o.ep=!0;const e=a(o);fetch(o.href,e)}})();function k(t){t.addSource("eraser",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[139.66434016560476,35.70734762727297],[139.66506846307053,35.707289104885675],[139.66513700246438,35.70688371493084],[139.66435569957977,35.70687233504728]]],type:"Polygon"}}]}}),t.addLayer({id:"eraser",type:"clip",source:"eraser",layout:{"clip-layer-types":["symbol","model"]}})}function O(t){let y=[139.6902,35.689],a={day:"day",night:"night",zero:"zero"},u=a.zero,o=!1,e,f,r,p=null,b=0;z(),t.addLayer({id:"flight-route-layer",type:"custom",renderingMode:"3d",onAdd:function(i,n){window.tb=new Threebox(i,n,{realSunlight:!0}),E()},render:function(i,n){tb.update()}});async function E(){e=tb.lightDateTime,console.log(e),e.setHours(4,0,0,0);let i=e.getHours()*3600+e.getMinutes()*60+e.getSeconds();r=document.getElementById("time"),r.value=i,f=i,g(e,y),r.oninput=()=>{i=+r.value,e.setHours(Math.floor(i/3600)),e.setMinutes(Math.floor(i/60)%60),e.setSeconds(i%60),t.triggerRepaint()};function n(s=new Date,h){let v=s.toLocaleString("en-US",{timeZone:h});return new Date(v)}t.on("render",()=>{tb.setSunlight(e),n(e,"Asia/Tokyo"),hour.innerHTML="Sunlight on date/time: "+e.toLocaleString(),g(e,y),t.sunPosition=tb.sunPosition});function g(s,h){const v=tb.getSunPosition(s,[-.12501974,51.53]);function I(c){return c*180/Math.PI}const T=I(v.azimuth);function B(c){return(c%360+360)%360}let x=tb.getSunTimes(s,h);if(s>=x.sunriseEnd&&s<=x.sunsetStart){if(u!=a.day||u==a.zero){let m=function(l){l.type=="line"&&t.setPaintProperty(l.id,"line-color","#a5cdfd"),l.type=="fill"&&t.setPaintProperty(l.id,"fill-color","#a5cdfd")};var N=m;console.log("it's day"),t.setPaintProperty("background","background-color","#7fb4f7"),t.setPaintProperty("building-extrusion","fill-extrusion-color","#ffffff"),t.setPaintProperty("custom-extrusion-layer","fill-extrusion-color","#ffffff"),u=a.day,o=!0,L(t,"Road network, surface").forEach(m)}}else if(u!=a.night){let m=function(l){l.type=="line"&&t.setPaintProperty(l.id,"line-color","#808080"),l.type=="fill"&&t.setPaintProperty(l.id,"fill-color","#808080")};var F=m;console.log("it's night"),t.setPaintProperty("background","background-color","#808080"),t.setPaintProperty("building-extrusion","fill-extrusion-color","#808080"),t.setPaintProperty("custom-extrusion-layer","fill-extrusion-color","#808080"),u=a.night,o=!1,L(t,"Road network, surface").forEach(m)}let S=document.getElementById("tickRate").value/10;var P=M(B(T));function M(c){return Math.round(c/S)*S}P!=b&&(t.setLights([{id:"directional",type:"directional",properties:{color:"rgba(255.0, 255.0, 255.0, 1.0)",intensity:1,direction:[P,60],"cast-shadows":o,"shadow-intensity":.5}}]),b=P)}}function z(){const i=document.getElementById("playButton"),n=document.getElementById("pauseButton");n.classList.add("active"),i.style.display="inline",n.style.display="none",i.addEventListener("click",()=>{i.classList.add("active"),n.classList.remove("active"),i.style.display="none",n.style.display="inline",p==null&&(p=setInterval(()=>{var g=parseInt(r.value)+250;r.value=g,r.dispatchEvent(new Event("input"))},100))}),n.addEventListener("click",()=>{n.classList.add("active"),i.classList.remove("active"),i.style.display="inline",n.style.display="none",p!=null&&(clearInterval(p),p=null)}),document.getElementById("resetButton").addEventListener("click",()=>{r.value=f,r.dispatchEvent(new Event("input"))})}function L(i,n){return i.getStyle().layers.filter(s=>s.metadata&&s.metadata["mapbox:group"]===n)}}const j="pk.eyJ1IjoidmZhc29ucGQiLCJhIjoiY2tvbTl3NHFvMHU1YjJ3bzd4cnp0c2h2NSJ9.MXSJRTka-63tR-t8RK-Xag";mapboxgl.accessToken=j;var w=[139.66461146239243,35.70698328883841];const d=new mapboxgl.Map({container:"map",center:w,zoom:15.27,pitch:42,bearing:-50,style:"mapbox://styles/vfasonpd/ckomjiv0e0bka17mzt5z7v5ij",minZoom:15,maxZoom:18});d.on("style.load",()=>{k(d),d.setConfigProperty("basemap","lightPreset","dusk"),d.addSource("model",{type:"geojson",data:{type:"Feature",properties:{"model-uri":"https://sonpd-vitalify-asia.github.io/BIMLoader/tower.glb"},geometry:{coordinates:w,type:"Point"}}}),d.addLayer({id:"tower",type:"model",slot:"middle",source:"model",minzoom:15,layout:{"model-id":["get","model-uri"]},paint:{"model-opacity":1,"model-rotation":[0,0,0],"model-scale":[1,1,1.5],"model-color-mix-intensity":0,"model-cast-shadows":!0,"model-emissive-strength":.8}});const t={type:"FeatureCollection",features:[{type:"Feature",properties:{height:15},geometry:{type:"Polygon",coordinates:[[[139.66444844801015,35.70729972742914],[139.66497690707288,35.70729609087284],[139.66493212240653,35.70808158318436],[139.66439918487717,35.70809249274527]]]}}]};d.addSource("custom-extrusion",{type:"geojson",data:t}),d.addLayer({id:"custom-extrusion-layer",type:"fill-extrusion",source:"custom-extrusion",paint:{"fill-extrusion-color":"#ffffff","fill-extrusion-height":["get","height"],"fill-extrusion-base":0,"fill-extrusion-opacity":1}}),O(d)});
