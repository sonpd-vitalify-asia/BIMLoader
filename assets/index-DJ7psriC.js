(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const t of o.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0});function i(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=i(a);fetch(a.href,o)}})();function G(r){r.addSource("eraser",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[139.66429613837335,35.7082379094738],[139.66500386564996,35.708254979006085],[139.66513700246438,35.70688371493084],[139.66435569957977,35.70687233504728]]],type:"Polygon"}}]}}),r.addLayer({id:"eraser",type:"clip",source:"eraser",layout:{"clip-layer-types":["symbol","model"]}})}function I(r){var e=window.THREE,i=[139.66461146239243,35.70698328883841],s=0,a=[Math.PI/2,e.MathUtils.degToRad(2),0],o=mapboxgl.MercatorCoordinate.fromLngLat(i,s);let t;var n={translateX:o.x,translateY:o.y,translateZ:o.z,rotateX:a[0],rotateY:a[1],rotateZ:a[2],scale:o.meterInMercatorCoordinateUnits()};r.addLayer({id:"building-layer",type:"custom",renderingMode:"3d",onAdd:function(u,m){this.camera=new e.Camera,this.scene=new e.Scene,t=new e.DirectionalLight(5921370,1),t.position.set(40,170,200);let c=1e3,l=2,d=8096;t.castShadow=!0,t.shadow.radius=l,t.shadow.mapSize.width=d,t.shadow.mapSize.height=d,t.shadow.camera.top=t.shadow.camera.right=c,t.shadow.camera.bottom=t.shadow.camera.left=-1e3,t.shadow.camera.near=50,t.shadow.camera.far=1e3,t.intensity=6,t.shadow.bias=1e-4,this.scene.add(t),u.dirLight=t;var p=new e.HemisphereLight(16777215,16777215,1);this.scene.add(p);var y=new e.GLTFLoader;y.load("./scene.glb",function(h){h.scene.traverse(function(v){v.isMesh&&(v.castShadow=!0,v.receiveShadow=!0)}),this.scene.add(h.scene);const f=new e.Box3().setFromObject(h.scene).getSize(new e.Vector3(0,0,0)),P=[f.x,f.y,f.z],L=Math.max(...P)*10,T=new e.PlaneBufferGeometry(L,L),z=new e.ShadowMaterial;z.opacity=.5;let g=new e.Mesh(T,z);g.rotateX(-Math.PI/2),g.receiveShadow=!0,this.scene.add(g);const _=new e.BoxGeometry(30,30,70),R=new e.ShadowMaterial({color:5855577,opacity:1});new e.MeshStandardMaterial({color:5855577,opacity:.5,transparent:!0});const M=new e.Mesh(_,R);M.receiveShadow=!0,M.position.set(-80,15,-25),this.scene.add(M);const k=new e.BoxGeometry(30,30,30),A=new e.ShadowMaterial({color:5855577,opacity:1});new e.MeshStandardMaterial({color:5855577,opacity:.5,transparent:!0});const S=new e.Mesh(k,A);S.receiveShadow=!0,S.position.set(-57,15,-42),this.scene.add(S);const j=new e.BoxGeometry(30,30,30),O=new e.ShadowMaterial({color:5855577,opacity:1});new e.MeshStandardMaterial({color:5855577,opacity:.5,transparent:!0});const b=new e.Mesh(j,O);b.receiveShadow=!0,b.position.set(-65,15,-71),this.scene.add(b);const C=new e.BoxGeometry(30,30,300),E=new e.ShadowMaterial({color:5855577,opacity:1});new e.MeshStandardMaterial({color:5855577,opacity:.5,transparent:!0});const x=new e.Mesh(C,E);x.receiveShadow=!0,x.position.set(80,15,0),this.scene.add(x)}.bind(this)),this.map=u,this.renderer=new e.WebGLRenderer({canvas:u.getCanvas(),context:m,antialias:!0}),this.renderer.autoClear=!1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=e.PCFSoftShadowMap},render:function(u,m){var c=new e.Matrix4().makeRotationAxis(new e.Vector3(1,0,0),n.rotateX),l=new e.Matrix4().makeRotationAxis(new e.Vector3(0,1,0),n.rotateY),d=new e.Matrix4().makeRotationAxis(new e.Vector3(0,0,1),n.rotateZ),p=new e.Matrix4().fromArray(m),y=new e.Matrix4().makeTranslation(n.translateX,n.translateY,n.translateZ).scale(new e.Vector3(n.scale,-n.scale,n.scale)).multiply(c).multiply(l).multiply(d);this.camera.projectionMatrix=p.multiply(y),this.renderer.state.reset(),this.renderer.render(this.scene,this.camera),this.map.triggerRepaint();const h=155;window.tb.sunPosition!=null&&(t.position.x=h*Math.sin(window.tb.sunPosition.azimuth),t.position.z=h*Math.cos(window.tb.sunPosition.azimuth))}})}function X(r){let e=[139.6902,35.689],i={day:"ckomjiv0e0bka17mzt5z7v5ij",night:"cma6doztc00dn01sl7wrl5zol"},s=i.day;r.addLayer({id:"flight-route-layer",type:"custom",renderingMode:"3d",onAdd:function(o,t){window.tb=new Threebox(o,t,{realSunlight:!0}),a()},render:function(o,t){tb.update()}});async function a(){let o=tb.lightDateTime,t=o.getHours()*3600+o.getMinutes()*60+o.getSeconds(),n=document.getElementById("time");n.value=t,n.oninput=()=>{t=+n.value,o.setHours(Math.floor(t/3600)),o.setMinutes(Math.floor(t/60)%60),o.setSeconds(t%60),r.triggerRepaint()};function u(c=new Date,l){let d=c.toLocaleString("en-US",{timeZone:l});return new Date(d)}r.on("render",()=>{tb.setSunlight(o),u(o,"Asia/Tokyo"),hour.innerHTML="Sunlight on date/time: "+o.toLocaleString(),m(o,e),r.sunPosition=tb.sunPosition});function m(c,l){let d=tb.getSunTimes(c,l);c>=d.sunriseEnd&&c<=d.sunsetStart?s!=i.day&&(console.log("it's day"),r.setPaintProperty("background","background-color","#7fb4f7"),s=i.day,r.dirLight.visible=!0):s!=i.night&&(console.log("it's night"),r.setPaintProperty("background","background-color","#808080"),s=i.night,r.dirLight.visible=!1)}}}const Z="pk.eyJ1IjoidmZhc29ucGQiLCJhIjoiY2tvbTl3NHFvMHU1YjJ3bzd4cnp0c2h2NSJ9.MXSJRTka-63tR-t8RK-Xag";mapboxgl.accessToken=Z;var B=[139.66288635632452,35.70886269295256];const w=new mapboxgl.Map({container:"map",center:B,zoom:15.27,pitch:42,bearing:-50,style:"mapbox://styles/vfasonpd/ckomjiv0e0bka17mzt5z7v5ij",minZoom:7,maxZoom:20,maxPitch:80});w.on("style.load",function(){G(w),X(w),I(w)});
