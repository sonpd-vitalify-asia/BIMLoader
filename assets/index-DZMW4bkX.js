(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const c of t.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function l(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(o){if(o.ep)return;o.ep=!0;const t=l(o);fetch(o.href,t)}})();function T(e){e.addSource("eraser",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[139.66434016560476,35.70734762727297],[139.66506846307053,35.707289104885675],[139.66513700246438,35.70688371493084],[139.66435569957977,35.70687233504728]]],type:"Polygon"}}]}}),e.addLayer({id:"eraser",type:"clip",source:"eraser",layout:{"clip-layer-types":["symbol","model"]}})}function z(e){let d=[139.6902,35.689],l={day:"day",night:"night",zero:"zero"},a=l.zero,o=!1,t,c,n,p=null;e.addLayer({id:"flight-route-layer",type:"custom",renderingMode:"3d",onAdd:function(r,y){window.tb=new Threebox(r,y,{realSunlight:!0}),L()},render:function(r,y){tb.update()}});async function L(){t=tb.lightDateTime;let r=t.getHours()*3600+t.getMinutes()*60+t.getSeconds();n=document.getElementById("time"),n.value=r,c=r,m(t,d),n.oninput=()=>{r=+n.value,t.setHours(Math.floor(r/3600)),t.setMinutes(Math.floor(r/60)%60),t.setSeconds(r%60),e.triggerRepaint()};function y(i=new Date,h){let P=i.toLocaleString("en-US",{timeZone:h});return new Date(P)}e.on("render",()=>{tb.setSunlight(t),y(t,"Asia/Tokyo"),hour.innerHTML="Sunlight on date/time: "+t.toLocaleString(),m(t,d),e.sunPosition=tb.sunPosition});function m(i,h){const P=tb.getSunPosition(i,[-.12501974,51.53]);function S(f){return f*180/Math.PI}const w=S(P.azimuth);function E(f){return(f%360+360)%360}let v=tb.getSunTimes(i,h);if(i>=v.sunriseEnd&&i<=v.sunsetStart){if(a!=l.day||a==l.zero){let g=function(s){s.type=="line"&&e.setPaintProperty(s.id,"line-color","#a5cdfd"),s.type=="fill"&&e.setPaintProperty(s.id,"fill-color","#a5cdfd")};var M=g;console.log("it's day"),e.setPaintProperty("background","background-color","#7fb4f7"),e.setPaintProperty("building-extrusion","fill-extrusion-color","#ffffff"),e.setPaintProperty("custom-extrusion-layer","fill-extrusion-color","#ffffff"),a=l.day,o=!0,b(e,"Road network, surface").forEach(g)}}else if(a!=l.night){let g=function(s){s.type=="line"&&e.setPaintProperty(s.id,"line-color","#808080"),s.type=="fill"&&e.setPaintProperty(s.id,"fill-color","#808080")};var k=g;console.log("it's night"),e.setPaintProperty("background","background-color","#808080"),e.setPaintProperty("building-extrusion","fill-extrusion-color","#808080"),e.setPaintProperty("custom-extrusion-layer","fill-extrusion-color","#808080"),a=l.night,o=!1,b(e,"Road network, surface").forEach(g)}e.setLights([{id:"directional",type:"directional",properties:{color:"rgba(255.0, 255.0, 255.0, 1.0)",intensity:1,direction:[E(w),45],"cast-shadows":o,"shadow-intensity":1}}])}}document.getElementById("playButton").addEventListener("click",()=>{p=setInterval(()=>{var r=parseInt(n.value)+50;n.value=r,n.dispatchEvent(new Event("input"))},100)}),document.getElementById("pauseButton").addEventListener("click",()=>{p!=null&&(clearInterval(p),p=null);const r=e.getStyle().layers;console.log(r)}),document.getElementById("resetButton").addEventListener("click",()=>{n.value=c,n.dispatchEvent(new Event("input"))});function b(r,y){return r.getStyle().layers.filter(i=>i.metadata&&i.metadata["mapbox:group"]===y)}}const I="pk.eyJ1IjoidmZhc29ucGQiLCJhIjoiY2tvbTl3NHFvMHU1YjJ3bzd4cnp0c2h2NSJ9.MXSJRTka-63tR-t8RK-Xag";mapboxgl.accessToken=I;var x=[139.66461146239243,35.70698328883841];const u=new mapboxgl.Map({container:"map",center:x,zoom:15.27,pitch:42,bearing:-50,style:"mapbox://styles/vfasonpd/ckomjiv0e0bka17mzt5z7v5ij",minZoom:15,maxZoom:18});u.on("style.load",()=>{T(u),u.setConfigProperty("basemap","lightPreset","dusk"),u.addSource("model",{type:"geojson",data:{type:"Feature",properties:{"model-uri":"https://sonpd-vitalify-asia.github.io/BIMLoader/tower.glb"},geometry:{coordinates:x,type:"Point"}}}),u.addLayer({id:"tower",type:"model",slot:"middle",source:"model",minzoom:15,layout:{"model-id":["get","model-uri"]},paint:{"model-opacity":1,"model-rotation":[0,0,0],"model-scale":[1,1,1.5],"model-color-mix-intensity":0,"model-cast-shadows":!0,"model-emissive-strength":.8}});const e={type:"FeatureCollection",features:[{type:"Feature",properties:{height:15},geometry:{type:"Polygon",coordinates:[[[139.66444844801015,35.70729972742914],[139.66497690707288,35.70729609087284],[139.66493212240653,35.70808158318436],[139.66439918487717,35.70809249274527]]]}}]};u.addSource("custom-extrusion",{type:"geojson",data:e}),u.addLayer({id:"custom-extrusion-layer",type:"fill-extrusion",source:"custom-extrusion",paint:{"fill-extrusion-color":"#ffffff","fill-extrusion-height":["get","height"],"fill-extrusion-base":0,"fill-extrusion-opacity":1}}),z(u)});
